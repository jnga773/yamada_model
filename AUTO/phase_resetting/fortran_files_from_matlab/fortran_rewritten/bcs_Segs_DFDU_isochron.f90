  !--------------------------------------------------------------------
  ! Slightly rewritten
  t2  = ABS(w1_seg2(1))
  t3  = ABS(w1_seg2(2))
  t4  = ABS(w1_seg2(3))
  t5  = x0_seg2(1) * 2.0d0
  t6  = x0_seg2(2) * 2.0d0
  t7  = x0_seg2(3) * 2.0d0
  t8  = x1_seg4(1) * 2.0d0
  t9  = x1_seg4(2) * 2.0d0
  t10 = x1_seg4(3) * 2.0d0
  t11 = t2 ** 2
  t12 = t3 ** 2
  t13 = t4 ** 2
  t14 = t11 + t12 + t13
  t15 = 1.0d0 / SQRT(t14)

  !------------------------------------------!
  !     Segments 1 and 2: State - Vector     !
  !------------------------------------------!
  J_out(1, 1)   = 1.0d0
  J_out(1, 25)  = -1.0d0
  J_out(2, 2)   = 1.0d0
  J_out(2, 26)  = -1.0d0
  J_out(3, 3)   = 1.0d0
  J_out(3, 27)  = -1.0d0
  J_out(4, 7)   = -1.0d0
  J_out(4, 19)  = 1.0d0
  J_out(5, 8)   = -1.0d0
  J_out(5, 20)  = 1.0d0
  J_out(6, 9)   = -1.0d0
  J_out(6, 21)  = 1.0d0
  J_out(7, 1)   = -gamma * (x0_seg1(2) + 1.0d0)
  J_out(7, 3)   = -gamma * x0_seg1(1)
  J_out(8, 10)  = -1.0d0
  J_out(8, 22)  = 1.0d0
  J_out(9, 11)  = -1.0d0
  J_out(9, 23)  = 1.0d0
  J_out(10, 12) = -1.0d0
  J_out(10, 24) = 1.0d0
  J_out(11, 4)  = mu_s
  J_out(11, 28) = -1.0d0
  J_out(12, 5)  = mu_s
  J_out(12, 29) = -1.0d0
  J_out(13, 6)  = mu_s
  J_out(13, 30) = -1.0d0
  J_out(14, 28) = t2 * t15 * (w1_seg2(1) / ABS(w1_seg2(1)))
  J_out(14, 29) = t3 * t15 * (w1_seg2(2) / ABS(w1_seg2(2)))
  J_out(14, 30) = t4 * t15 * (w1_seg2(3) / ABS(w1_seg2(3)))

  !-------------------!
  !     Segment 3     !
  !-------------------!
  J_out(15, 1)  = -1.0d0
  J_out(15, 31) = 1.0d0
  J_out(16, 2)  = -1.0d0
  J_out(16, 32) = 1.0d0
  J_out(17, 3)  = -1.0d0
  J_out(17, 33) = 1.0d0

  !-------------------!
  !     Segment 4     !
  !-------------------!
  J_out(18, 13) = -1.0d0
  J_out(18, 16) = 1.0d0
  J_out(19, 14) = -1.0d0
  J_out(19, 17) = 1.0d0
  J_out(20, 15) = -1.0d0
  J_out(20, 18) = 1.0d0
  J_out(21, 7)  = -w0_seg2(1)
  J_out(21, 8)  = -w0_seg2(2)
  J_out(21, 9)  = -w0_seg2(3)
  J_out(21, 10) = -x0_seg2(1) + x1_seg4(1)
  J_out(21, 11) = -x0_seg2(2) + x1_seg4(2)
  J_out(21, 12) = -x0_seg2(3) + x1_seg4(3)
  J_out(21, 34) = w0_seg2(1)
  J_out(21, 35) = w0_seg2(2)
  J_out(21, 36) = w0_seg2(3)
  J_out(22, 7)  = t5 - t8
  J_out(22, 8)  = t6 - t9
  J_out(22, 9)  = t7 - t10
  J_out(22, 34) = -t5 + t8
  J_out(22, 35) = -t6 + t9
  J_out(22, 36) = -t7 + t10

  !-----------------------------!
  !     Isochron Monitoring     !
  !-----------------------------!
  J_out(23, 16) = -1.0d0
  J_out(24, 17) = -1.0d0
  J_out(25, 18) = -1.0d0
