!--------------------------------------------------------------------
! Slightly rewritten
!--------------------------------------------------------------------
! Slightly rewritten
t2  = a * x1_vec(3)
t3  = a * x2_vec(3)
t4  = x1_vec(3) + 1.0d0
t5  = x2_vec(3) + 1.0d0
t6  = T * k * x4_vec(3)
t7  = T * theta_new * w1_vec(3)
t8  = T * theta_new * x1_vec(3)
t9  = theta_old - 1.0d0
t10 = theta_new - 1.0d0
t11 = -x1_vec(1)
t12 = -x2_vec(1)
t13 = T * gamma * theta_new * w1_vec(1)
t14 = T * gamma * theta_new * x1_vec(1)
t15 = t2 + 1.0d0
t16 = t3 + 1.0d0
t17 = T * a * gamma * theta_new * w1_vec(2)
t18 = T * a * gamma * theta_new * x1_vec(2)
t19 = -t7
t20 = -t8
t21 = T * gamma * t4 * theta_new
t22 = t11 + x1_vec(2) + 1.0d0
t23 = t12 + x2_vec(2) + 1.0d0
t24 = T * t10 * w2_vec(3)
t25 = T * t9 * x3_vec(3)
t26 = T * t10 * x2_vec(3)
t27 = T * gamma * t10 * w2_vec(1)
t28 = T * gamma * t10 * x2_vec(1)
t29 = T * gamma * t15 * theta_new
t30 = T * a * gamma * t10 * w2_vec(2)
t31 = T * a * gamma * t10 * x2_vec(2)
t32 = -t24
t33 = -t26
t34 = -t27
t35 = T * gamma * t5 * t10
t36 = T * t22 * theta_new
t37 = t7 + t17
t38 = -t30
t39 = t13 + t19
t40 = T * gamma * t10 * t16
t41 = T * t10 * t23
t42 = t24 + t34
t43 = t32 + t38

J_out(1, 1)   = -t21
J_out(1, 3)   = T * gamma * t11 * theta_new
J_out(2, 2)   = -t29
J_out(2, 3)   = -t18
J_out(3, 1)   = t8
J_out(3, 2)   = t20
J_out(3, 3)   = -t36
J_out(4, 3)   = t39
J_out(4, 4)   = t21
J_out(4, 6)   = t20
J_out(5, 3)   = t37
J_out(5, 5)   = t29
J_out(5, 6)   = t8
J_out(6, 1)   = t39
J_out(6, 2)   = t37
J_out(6, 4)   = t14
J_out(6, 5)   = t18
J_out(6, 6)   = t36
J_out(7, 7)   = t35
J_out(7, 9)   = t28
J_out(8, 8)   = t40
J_out(8, 9)   = t31
J_out(9, 7)   = t33
J_out(9, 8)   = t26
J_out(9, 9)   = t41
J_out(10, 9)  = t42
J_out(10, 10) = -t35
J_out(10, 12) = t26
J_out(11, 9)  = t43
J_out(11, 11) = -t40
J_out(11, 12) = t33
J_out(12, 7)  = t42
J_out(12, 8)  = t43
J_out(12, 10) = T * gamma * t10 * t12
J_out(12, 11) = -t31
J_out(12, 12) = -t41
J_out(13, 13) = T * gamma * t9 * (x3_vec(3) + 1.0d0)
J_out(13, 15) = T * gamma * t9 * x3_vec(1)
J_out(14, 14) = T * gamma * t9 * (a * x3_vec(3) + 1.0d0)
J_out(14, 15) = T * a * gamma * t9 * x3_vec(2)
J_out(15, 13) = -t25
J_out(15, 14) = t25
J_out(15, 15) = -T * t9 * (x3_vec(1) - x3_vec(2) - 1.0d0)
J_out(16, 16) = -T * gamma * k * (x4_vec(3) + 1.0d0)
J_out(16, 18) = -T * gamma * k * x4_vec(1)
J_out(17, 17) = -T * gamma * k * (a * x4_vec(3) + 1.0d0)
J_out(17, 18) = -T * a * gamma * k * x4_vec(2)
J_out(18, 16) = t6
J_out(18, 17) = -t6
J_out(18, 18) = T * k * (x4_vec(1) - x4_vec(2) - 1.0d0)
